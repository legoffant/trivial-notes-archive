<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <title>Mirroring et Repository | Trivial notes</title>
    <meta name="google-site-verification" content="JcJZKibD3r33MuyAhypM_Rtcw51x0x7x_SwDKkuy4KE" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="keywords" content="" />
    <meta name="author" content="Anthony Le Goff" />
    <meta name="kittycheck_rumble" content="true" />
    <meta name="kittycheck_position" content="top=60,right=60" />

    <!-- Le styles -->
    <link rel="stylesheet" href="/theme/css/bootstrap.min.css" type="text/css" />
    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
      .tag-1 {
        font-size: 13pt;
      }
      .tag-2 {
        font-size: 10pt;
      }
      .tag-2 {
        font-size: 8pt;
      }
      .tag-4 {
        font-size: 6pt;
     }
    </style>
    <link href="/theme/css/bootstrap-responsive.min.css" rel="stylesheet">
    <link href="/theme/css/font-awesome.css" rel="stylesheet">
    <link href="/theme/css/pygments.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/theme/img/favicon.ico">
    <link rel="apple-touch-icon" href="/theme/img/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/theme/img/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/theme/img/apple-touch-icon-114x114.png">

    <link href="/" type="application/atom+xml" rel="alternate" title="Trivial notes ATOM Feed" />
  </head>
  <body>
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="/index.html">Trivial notes </a>
          <div class="nav-collapse">
            <ul class="nav">
                <li ><a href="/pages/contact.html">Contact</a></li>
                <li ><a href="/pages/ltcb.html">LTCB</a></li>
                <li class="divider-vertical"></li>
                <li >
                  <a href="/category/cc.html">
						        <i class="icon-folder-open icon-large"></i>C/C++
					         </a>
                </li>
                <li >
                  <a href="/category/entrepreneurship.html">
						        <i class="icon-folder-open icon-large"></i>Entrepreneurship
					         </a>
                </li>
                <li >
                  <a href="/category/inclassable.html">
						        <i class="icon-folder-open icon-large"></i>Inclassable
					         </a>
                </li>
                <li class="active">
                  <a href="/category/linux.html">
						        <i class="icon-folder-open icon-large"></i>Linux
					         </a>
                </li>
                <li >
                  <a href="/category/transhumanisme.html">
						        <i class="icon-folder-open icon-large"></i>Transhumanisme
					         </a>
                </li>
              <ul class="nav pull-right">
                    <li><a href="/"><i class="icon-th-list"></i>Archives</a></li>
              </ul>

            </ul>
            <!--<p class="navbar-text pull-right">Logged in as <a href="#">username</a></p>-->
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container">
      <div class="row">
        <div class="span8" id="content">
<div class="row">
    <div class="span2">
        <div class="well">
<footer class="post-info">
<abbr class="published" title="2023-07-10T21:44:00+02:00">
    <i class="icon-calendar"></i>&nbsp;lun. 10 juillet 2023
</abbr>
<br/><a href="/author/anthony-le-goff.html"><i class="icon-user"></i>&nbsp;Anthony Le Goff</a>


<br/>
	&nbsp;&nbsp;<a href="/tag/mirror.html" class="label"><i class="icon-tag"></i>&nbsp;mirror</a>
	&nbsp;&nbsp;<a href="/tag/repo.html" class="label"><i class="icon-tag"></i>&nbsp;repo</a>
</footer><!-- /.post-info -->        </div>
    </div>
    <div class="span6">
<section id="content" class="well">
    <article>
        <header>
            <h1>
                <a href=""
                        rel="bookmark"
                        title="Permalink to Mirroring et Repository">
                        Mirroring et Repository
                </a>
            </h1>
        </header>
        <div class="entry-content">

        <p>Un concept essentiel dans le monde des hackers et Linux est l'hébergement de fichier sur un serveur Web HTTP ou un FTP. Que cela soit pour y accéder vous même à distance tel une archive ou tout simplement partager de l'information. Les robots des moteurs de recherche peuvent indexer ces fichiers, tel que du Web Crawling.  </p>
<p>C'est le fameux <strong>Index of</strong>. La racine du site.  </p>
<p>La page <strong>Index of</strong> indique que le répertoire cible concerné ne contient pas de fichier <strong>index.php</strong> ou <strong>index.html</strong>. Un fichier de ce type constitue le « <em>point d'entrée</em> » de votre site web. Le nom de ce fichier est normalisé. Alors elle affiche les fichiers et dossiers avec les droits de lecture selon les permissions.  </p>
<p>On retrouve deux cas en particulier ou la page Index of est invoqué:  </p>
<ul>
<li>
<p>Les sites de miroir (mirroring)  </p>
</li>
<li>
<p>Les dépôts (repository)  </p>
</li>
</ul>
<p>Sous Windows, vous avez sûrement jamais entendu parler, alors que dans le monde de Linux, c'est la règle. Un simple web serveur sous Apache ou Nginx suffit, même si on peut configurer en FTP. Il est possible également de protéger en accès avec un mot de passe ou du SFTP via SSH.  </p>
<h3>Mirroring</h3>
<p>Sous Linux, la mise à jour du système fonctionne par des sites miroir qui sont des sources officielles de dépôts logiciels (package) mais également des .iso. Vous pouvez créer en auto-hébergement votre propre site miroir, mais faut avoir une bande passante importante.  </p>
<p>Exemple, sur l'adresse de Gandi.net en France, le repo des iso d'Arch Linux du mois de juillet 2023:  </p>
<ul>
<li><a href="https://mirrors.gandi.net/archlinux/iso/2023.07.01/">https://mirrors.gandi.net/archlinux/iso/2023.07.01/</a>  </li>
</ul>
<p>Les sites miroirs sont nombreux, l'intérêt est de répliquer des données, certains sont lents, d'autres ne sont pas protéger en HTTPS. Quand vous faites une mise à jour cela de l'importance. Sous Arch Linux c'est l'outil reflector et l'édition du fichier /etc/pacman.d/mirrorlist  </p>
<h3>Repository</h3>
<p>L'autre cas est un simple dépôt de document, PDF etc.... Tel qu'une librairie pirate, avec un peu de violation de droit d'auteur. Après tout dépend de la loi du pays, des ayants-droits et de l'hébergement.  </p>
<p>Les deux exemples que je connais sont:  </p>
<ul>
<li><a href="https://doc.lagout.org/">https://doc.lagout.org/</a>  </li>
<li><a href="https://repo.zenk-security.com/">https://repo.zenk-security.com/</a> (français + 1700 livres en sécurité informatique)  </li>
</ul>
<p>Mais il y en a d'autres dans le web obscure qui ne sont pas indexé. Il est possible de télécharger l'ensemble des fichiers sur un ordinateur en utilisant la commande wget.  </p>
<p>L'aspect important est sa capacité de <strong>téléchargements récursifs</strong>, avec lesquels il créé un miroir des sites Web. Il transfère des parties d’un site Web en suivant les liens et la structure des répertoires, créant ainsi des versions locales des pages Web.  </p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>wget<span class="w"> </span>-r<span class="w"> </span>ftp://exemple.com/repertoire<span class="w">  </span>
</code></pre></div>

<h3>Installer une interface sophistiquée de Repository avec h5ai</h3>
<p>La racine Index of d'un web serveur n'est pas très glamour, c'est un peu du brute de décoffrage.  </p>
<p><img alt="index of" src="images/indexOf.png"></p>
<p>On va donc l'améliorer et la personnaliser avec un template sous php h5ai : <a href="https://larsjung.de/h5ai/">https://larsjung.de/h5ai/</a>  </p>
<p>Quelques lignes de code pour configurer avec Nginx en HTTPS en utilisant mon propre exemple de projet sous lib.qasari.net. NOTA: il manque la génération de certificat SSL de Let's Encrypt avec certbot:  </p>
<p>Tools server  </p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>apt<span class="w"> </span>get<span class="w"> </span>install<span class="w"> </span>nano<span class="w"> </span>vim<span class="w"> </span>nano<span class="w"> </span>wget<span class="w"> </span>unzip<span class="w"> </span>bash-completion<span class="w">  </span>
</code></pre></div>

<p>Installation de php et nginx  </p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>php-fpm<span class="w"> </span>nginx

$<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>php-fpm
</code></pre></div>

<p>Télécharger h5ai  </p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>/var/www<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>mkdir<span class="w"> </span>lib.qasari.net<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>lib.qasari.net<span class="w">  </span>
$<span class="w"> </span>wget<span class="w"> </span>https://release.larsjung.de/h5ai/h5ai-0.30.0.zip<span class="w">  </span>
$<span class="w"> </span>unzip<span class="w"> </span>h5ai-0.30.0.zip<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>rm<span class="w"> </span>h5ai-0.30.0.zip<span class="w">  </span>
</code></pre></div>

<p>Structure tree  </p>
<div class="highlight"><pre><span></span><code>/var/www/lib.qasari.net/  
 ├─ \_h5ai  
 ├─ vos fichiers  
 └─ et vos dossier  
</code></pre></div>

<p>Il va falloir configurer un minimum h5ai pour cela direction le fichier de config de h5ai : <code>/_h5ai/private/conf/options.json</code>.  </p>
<p>Ne pas oublier de changer le détenteur du groupe:  </p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>chown<span class="w"> </span>-R<span class="w"> </span>www-data:www-data<span class="w"> </span>/var/www/lib.qasari.net<span class="w">  </span>
</code></pre></div>

<p>Configuration Nginx  </p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>nano<span class="w"> </span>/etc/nginx/sites-available/lib.qasari.net
</code></pre></div>

<div class="highlight"><pre><span></span><code>#### Configuration du HTTPS  
server {  
     listen 443 ssl http2;  
     listen \[::\]:443 ssl http2;  
     server\_name lib.qasari.net;  
     root /var/www/lib.qasari.net;  
     index index.php /\_h5ai/public/index.php;


    # individual nginx logs for this vhost  
    access\_log  /var/log/nginx/lib.qasari.net\_access.log; # change to your own domain  
    error\_log   /var/log/nginx/lib.qasari.net\_error.log;  # change to your own domain  
          
    location ^~ /var/www/lib.qasari.net/\_h5ai/private {  
         deny all;  
         return 403;  
    }

    # configuration de php-fpm  
    location ~ \[^/\]\\.php(/|$) {  
        fastcgi\_split\_path\_info ^(.+?\\.php)(/.\*)$;  
         if (!-f $document\_root$fastcgi\_script\_name) {  
            return 404;  
        }  
        fastcgi\_pass unix:/run/php/php8.2-fpm.sock;  # change la version  
        fastcgi\_index index.php;  
        include fastcgi.conf;  
    }

    # configuration de SSL

    # Emplacement du certificat si on utilise Letsencrypt  
    ssl\_certificate         /etc/letsencrypt/live/..../fullchain.pem;  
    ssl\_certificate\_key     /etc/letsencrypt/live/..../privkey.pem;

    ssl\_session\_timeout     10m;  
    ssl\_prefer\_server\_ciphers   on;  
    ssl\_stapling            on;  
    ssl\_stapling\_verify     on;  
    ssl\_protocols           TLSv1.1 TLSv1.2;  
    ssl\_ciphers         &quot;ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4&quot;;

    add\_header Strict-Transport-Security &quot;max-age=31557600; includeSubDomains&quot;;

    location ~ \\.(jpg|jpeg|gif|png|css|js|ico|svg|eot|ttf|woff|woff2|otf)$ {  
         access\_log        off;  
         expires           30d;  
    }  
}

#### Redirection HTTP vers HTTPS  
 server {  
     listen 80;  
     listen \[::\]:80;  
     server\_name lib.qasari.net;  
     return 301 https://lib.qasari.net$request\_uri;  
}
</code></pre></div>

<p>Link site enable:  </p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ln<span class="w"> </span>-s<span class="w"> </span>/etc/nginx/sites-available/lib.qasari.net<span class="w"> </span>/etc/nginx/sites-enabled/lib.qasari.net
</code></pre></div>

<p>Vérification et restart</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>nginx-t<span class="w">  </span>
$<span class="w"> </span>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>nginx
</code></pre></div>
        </div><!-- /.entry-content -->
    </article>
</section>
</div>
</div>
        </div><!--/span-->
        <div class="span3 well sidebar-nav" id="sidebar">
<ul class="nav nav-list">
<li class="nav-header"><h4><i class="icon-external-link"></i>blogroll</h4></li>
    <li><div><i class="icon-external-link"></i><a href="https://getpelican.com/">Pelican</a></div></li>
    <li><div><i class="icon-external-link"></i><a href="https://www.python.org/">Python.org</a></div></li>
    <li><div><i class="icon-external-link"></i><a href="https://framabook.org/le-c-en-20-heures-2/">Apprendre le C en 20H</a></div></li>
    <li><div><i class="icon-external-link"></i><a href="https://archlinux.org/">Arch Linux</a></div></li>
    <li><div><i class="icon-external-link"></i><a href="https://www.blackarch.io/">Blackarch</a></div></li>
    <li><div><i class="icon-external-link"></i><a href="https://www.kernel.org/">Kernel</a></div></li>
    <li><div><i class="icon-external-link"></i><a href="https://www.arduino.cc/">Arduino</a></div></li>
    <li><div><i class="icon-external-link"></i><a href="https://beagleboard.org/bone">BeagleBoard</a></div></li>
<li class="nav-header"><h4><i class="icon-home icon-large"></i> social</h4></li>
    <li><a href="https://github.com/legoffant"><i class="icon-Github-sign icon-large"></i>Github</a></li>
    <li><a href="https://twitter.com/anth_lg"><i class="icon-Twitter-sign icon-large"></i>Twitter</a></li>

<li class="nav-header"><h4><i class="icon-folder-close icon-large"></i>Categories</h4></li>
<li>
<a href="/category/cc.html">
    <i class="icon-folder-open icon-large"></i>C/C++
</a>
</li>
<li>
<a href="/category/entrepreneurship.html">
    <i class="icon-folder-open icon-large"></i>Entrepreneurship
</a>
</li>
<li>
<a href="/category/inclassable.html">
    <i class="icon-folder-open icon-large"></i>Inclassable
</a>
</li>
<li>
<a href="/category/linux.html">
    <i class="icon-folder-open icon-large"></i>Linux
</a>
</li>
<li>
<a href="/category/transhumanisme.html">
    <i class="icon-folder-open icon-large"></i>Transhumanisme
</a>
</li>



</ul>        </div><!--/.well -->

      </div><!--/row-->

      <hr>

    </div><!--/.fluid-container-->


    <!-- Le javascript -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="/theme/js/jquery-1.7.2.min.js"></script>
    <script src="/theme/js/bootstrap.min.js"></script>
  </body>
</html>